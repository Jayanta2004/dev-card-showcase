<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gravitational Anomaly Â· Black Hole Accretion</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Avenir', 'Segoe UI', sans-serif;
            background-color: black;
            color: white;
        }
        #event-horizon-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 50;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid #aa3377;
            border-radius: 40px;
            padding: 14px 32px;
            display: flex;
            gap: 40px;
            border-left: 6px solid #ff44aa;
            box-shadow: 0 0 50px rgba(255,68,170,0.3);
            pointer-events: none;
        }
        .panel-item {
            display: flex;
            flex-direction: column;
        }
        .panel-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #ff99cc;
            letter-spacing: 1px;
        }
        .panel-value {
            font-size: 1.6rem;
            font-weight: 600;
            background: linear-gradient(135deg, #fff, #ffaaff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        #accretion-stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(10, 0, 15, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid #ff66aa;
            border-radius: 48px;
            padding: 20px 32px;
            z-index: 50;
            border-right: 6px solid #ff44aa;
            min-width: 260px;
            text-align: right;
            box-shadow: 0 15px 35px rgba(200,0,100,0.3);
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1rem;
        }
        .stat-label {
            color: #ff88bb;
        }
        .stat-value {
            font-weight: 600;
            color: #ffd0e0;
        }
        .pulse-red {
            width: 14px;
            height: 14px;
            background: #ff3366;
            border-radius: 50%;
            box-shadow: 0 0 30px #ff3366;
            animation: red-pulse 1.2s infinite;
        }
        @keyframes red-pulse {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.4); background: #ff6699; }
            100% { opacity: 0.5; transform: scale(1); }
        }
        #lensing-note {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: rgba(20, 0, 20, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid #aa3377;
            border-radius: 40px;
            padding: 12px 28px;
            z-index: 50;
            border-left: 4px solid #ff44aa;
            color: #ffccdd;
        }
        #jet-indicator {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(30, 0, 30, 0.85);
            backdrop-filter: blur(8px);
            border: 1px solid #ffaa88;
            border-radius: 40px;
            padding: 16px 28px;
            z-index: 50;
            text-align: center;
            border-bottom: 4px solid #ff8866;
        }
        .glow-number {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffccaa, #ff6688);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <div id="event-horizon-panel">
        <div class="panel-item">
            <span class="panel-label">mass</span>
            <span class="panel-value">6.8<span style="font-size:1rem;"> Mâ˜‰</span></span>
        </div>
        <div class="panel-item">
            <span class="panel-label">spin</span>
            <span class="panel-value">0.92<span style="font-size:1rem;"> c</span></span>
        </div>
        <div class="panel-item">
            <span class="panel-label">photons</span>
            <span class="panel-value">1.4e6</span>
        </div>
    </div>

    <div id="accretion-stats">
        <div style="display: flex; gap: 12px; align-items: center; justify-content: flex-end; margin-bottom: 16px;">
            <span class="pulse-red"></span>
            <span style="font-weight: 600; font-size: 1.3rem;">ðŸ’« ACCRETION DISK</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">inner radius</span>
            <span class="stat-value">3.2 R<sub>g</sub></span>
        </div>
        <div class="stat-row">
            <span class="stat-label">temperature</span>
            <span class="stat-value" id="temp-display">12.8 MK</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">luminosity</span>
            <span class="stat-value">1.2e38 W</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">jet power</span>
            <span class="stat-value" id="jet-power">4.5e36 W</span>
        </div>
    </div>

    <div id="lensing-note">
        âš« gravitational lensing Â· photon sphere Â· frame dragging
    </div>

    <div id="jet-indicator">
        <div style="font-size:1rem;">ðŸŒŒ RELATIVISTIC JET</div>
        <div class="glow-number" id="jet-speed">0.87c</div>
        <div style="font-size:0.8rem;">> 5000 ly</div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';
        
        // --- Scene setup ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x030005);
        
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 8, 25);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = false;
        renderer.toneMapping = THREE.ReinhardToneMapping;
        renderer.toneMappingExposure = 1.2;
        document.body.appendChild(renderer.domElement);
        
        const labelRenderer = new CSS2DRenderer();
        labelRenderer.setSize(window.innerWidth, window.innerHeight);
        labelRenderer.domElement.style.position = 'absolute';
        labelRenderer.domElement.style.top = '0';
        labelRenderer.domElement.style.left = '0';
        labelRenderer.domElement.style.pointerEvents = 'none';
        document.body.appendChild(labelRenderer.domElement);
        
        // --- Controls ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.8;
        controls.enableZoom = true;
        controls.maxDistance = 50;
        controls.minDistance = 10;
        
        // --- Lighting ---
        const ambient = new THREE.AmbientLight(0x402030);
        scene.add(ambient);
        
        const pointLight = new THREE.PointLight(0xff8866, 1, 30);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);
        
        // --- Starfield (dense) ---
        const starsGeo = new THREE.BufferGeometry();
        const starsCount = 6000;
        const starsPos = new Float32Array(starsCount * 3);
        for (let i = 0; i < starsCount*3; i+=3) {
            const r = 50 + Math.random() * 100;
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.acos(2 * Math.random() - 1);
            starsPos[i] = Math.sin(phi) * Math.cos(theta) * r;
            starsPos[i+1] = Math.sin(phi) * Math.sin(theta) * r;
            starsPos[i+2] = Math.cos(phi) * r;
        }
        starsGeo.setAttribute('position', new THREE.BufferAttribute(starsPos, 3));
        const starsMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.2, transparent: true });
        const stars = new THREE.Points(starsGeo, starsMat);
        scene.add(stars);
        
        // --- Black hole (event horizon) ---
        const horizonGeo = new THREE.SphereGeometry(2.5, 64, 64);
        const horizonMat = new THREE.MeshStandardMaterial({ 
            color: 0x000000,
            emissive: 0x220000,
            roughness: 0.1,
            metalness: 0.9
        });
        const horizon = new THREE.Mesh(horizonGeo, horizonMat);
        horizon.position.set(0, 0, 0);
        scene.add(horizon);
        
        // --- Accretion disk (particle system) ---
        const diskParticles = 15000;
        const diskGeo = new THREE.BufferGeometry();
        const diskPositions = new Float32Array(diskParticles * 3);
        const diskColors = new Float32Array(diskParticles * 3);
        
        for (let i = 0; i < diskParticles; i++) {
            // Random radius from 3 to 8
            const r = 3 + Math.random() * 5;
            const angle = Math.random() * Math.PI * 2;
            // Flattened in y, with slight thickness
            const y = (Math.random() - 0.5) * 0.8 * Math.exp(-(r-3)/2);
            
            const x = Math.cos(angle) * r;
            const z = Math.sin(angle) * r;
            
            diskPositions[i*3] = x;
            diskPositions[i*3+1] = y;
            diskPositions[i*3+2] = z;
            
            // Color based on radius and temperature
            const t = (r - 3) / 5; // 0 inner hot, 1 outer cooler
            const rColor = 1.0 - t * 0.7;
            const gColor = 0.6 - t * 0.4;
            const bColor = 0.2 + t * 0.3;
            
            diskColors[i*3] = rColor;
            diskColors[i*3+1] = gColor;
            diskColors[i*3+2] = bColor;
        }
        
        diskGeo.setAttribute('position', new THREE.BufferAttribute(diskPositions, 3));
        diskGeo.setAttribute('color', new THREE.BufferAttribute(diskColors, 3));
        
        const diskMat = new THREE.PointsMaterial({ 
            size: 0.12,
            vertexColors: true,
            blending: THREE.AdditiveBlending,
            transparent: true,
            depthWrite: false
        });
        
        const disk = new THREE.Points(diskGeo, diskMat);
        scene.add(disk);
        
        // --- Inner hot plasma (glow) ---
        const innerGlowGeo = new THREE.SphereGeometry(2.8, 32, 32);
        const innerGlowMat = new THREE.MeshBasicMaterial({ 
            color: 0xff5500,
            transparent: true,
            opacity: 0.15,
            blending: THREE.AdditiveBlending,
            side: THREE.BackSide
        });
        const innerGlow = new THREE.Mesh(innerGlowGeo, innerGlowMat);
        scene.add(innerGlow);
        
        // --- Photon sphere (translucent) ---
        const photonGeo = new THREE.SphereGeometry(3.7, 48, 48);
        const photonMat = new THREE.MeshPhongMaterial({
            color: 0xffaa66,
            emissive: 0x442200,
            transparent: true,
            opacity: 0.08,
            side: THREE.DoubleSide,
            wireframe: true
        });
        const photonSphere = new THREE.Mesh(photonGeo, photonMat);
        scene.add(photonSphere);
        
        // --- Relativistic jet (particle stream) ---
        const jetParticles = 4000;
        const jetGeo = new THREE.BufferGeometry();
        const jetPositions = new Float32Array(jetParticles * 3);
        
        for (let i = 0; i < jetParticles; i++) {
            // Upward jet
            const r = Math.random() * 15;
            const angle = Math.random() * Math.PI * 2;
            const x = Math.cos(angle) * r * 0.3;
            const z = Math.sin(angle) * r * 0.3;
            const y = 2.5 + Math.random() * 12;
            
            jetPositions[i*3] = x;
            jetPositions[i*3+1] = y;
            jetPositions[i*3+2] = z;
        }
        jetGeo.setAttribute('position', new THREE.BufferAttribute(jetPositions, 3));
        const jetMat = new THREE.PointsMaterial({ color: 0xffaa88, size: 0.15, blending: THREE.AdditiveBlending });
        const jet = new THREE.Points(jetGeo, jetMat);
        scene.add(jet);
        
        // Downward jet (mirror)
        const jetDownGeo = new THREE.BufferGeometry();
        const jetDownPositions = new Float32Array(jetParticles * 3);
        for (let i = 0; i < jetParticles; i++) {
            const r = Math.random() * 15;
            const angle = Math.random() * Math.PI * 2;
            const x = Math.cos(angle) * r * 0.3;
            const z = Math.sin(angle) * r * 0.3;
            const y = -2.5 - Math.random() * 12;
            
            jetDownPositions[i*3] = x;
            jetDownPositions[i*3+1] = y;
            jetDownPositions[i*3+2] = z;
        }
        jetDownGeo.setAttribute('position', new THREE.BufferAttribute(jetDownPositions, 3));
        const jetDownMat = new THREE.PointsMaterial({ color: 0xffaa88, size: 0.15, blending: THREE.AdditiveBlending });
        const jetDown = new THREE.Points(jetDownGeo, jetDownMat);
        scene.add(jetDown);
        
        // --- Gravitational lensing effect (distorted background stars) - we can add a few moving sprites? Not easily done in realtime.
        // Instead, we'll add a few glowing rings
        for (let i = 0; i < 3; i++) {
            const ringGeo = new THREE.TorusGeometry(3.0 + i*0.5, 0.05, 16, 64);
            const ringMat = new THREE.MeshStandardMaterial({ color: 0xff8866, emissive: 0x331100 });
            const ring = new THREE.Mesh(ringGeo, ringMat);
            ring.rotation.x = Math.PI / 2;
            ring.rotation.z = i * 0.5;
            scene.add(ring);
        }
        
        // --- Animate ---
        let time = 0;
        
        function animate() {
            requestAnimationFrame(animate);
            
            time += 0.005;
            
            // Rotate accretion disk
            disk.rotation.y += 0.002;
            disk.rotation.x = 0.2;
            
            // Rotate photon sphere
            photonSphere.rotation.y += 0.001;
            photonSphere.rotation.x = 0.1;
            
            // Pulse inner glow
            innerGlow.material.opacity = 0.15 + Math.sin(time * 3) * 0.05;
            
            // Update displays
            document.getElementById('temp-display').innerText = (12 + Math.sin(time)*0.5).toFixed(1) + ' MK';
            document.getElementById('jet-power').innerText = (4.5 + Math.sin(time*2)*0.3).toFixed(1) + 'e36 W';
            document.getElementById('jet-speed').innerText = (0.87 + Math.sin(time*1.5)*0.02).toFixed(2) + 'c';
            
            controls.update();
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }
        
        animate();
        
        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>